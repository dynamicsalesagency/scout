<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bulk Mailto Generator</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .container {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
      max-width: 700px;
      width: 100%;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    label {
      display: block;
      margin-top: 1.2rem;
      color: #34495e;
    }
    textarea, input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-top: 0.4rem;
      font-size: 1rem;
    }
    button {
      margin-top: 1.5rem;
      padding: 0.75rem;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #0056b3;
    }
    .mailto-link {
      display: block;
      margin: 0.5rem 0;
      word-break: break-word;
      color: #2980b9;
      text-decoration: none;
    }
    .mailto-link:hover {
      text-decoration: underline;
    }
    .sent {
      text-decoration: line-through;
      color: gray;
    }
    .tabs {
      margin-top: 1rem;
      display: flex;
      gap: 1rem;
      justify-content: center;
    }
    .tab {
      cursor: pointer;
      padding: 0.5rem 1rem;
      background: #ddd;
      border-radius: 8px;
    }
    .tab.active {
      background: #007bff;
      color: white;
    }
    .warning {
      color: red;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Bulk Mailto Generator</h1>

    <label for="emails">üìß Paste emails (any format):</label>
    <textarea id="emails" rows="4" placeholder="example@domain.com John Doe\nuser@example.com Jane Smith"></textarea>

    <label for="subject">‚úèÔ∏è Subject:</label>
    <input type="text" id="subject" placeholder="Enter email subject">

    <label for="body">üìù Message:</label>
    <textarea id="body" rows="5" placeholder="Hello {name},\n\nYour message here..."></textarea>

    <button id="generate">Generate Mailto Links</button>

    <div class="tabs">
      <div class="tab active" data-tab="pending">Pending</div>
      <div class="tab" data-tab="sent">Sent</div>
    </div>

    <div id="links"></div>
  </div>

  <script>
    const escapeMailContent = str => encodeURIComponent(str).replace(/%20/g, '+');
    const extractEmails = text => {
      const lines = text.split(/\n+/);
      const results = [];
      lines.forEach(line => {
        const match = line.match(/([\w.-]+@[\w.-]+)\s*(.*)/);
        if (match) {
          results.push({ email: match[1], name: match[2] || match[1].split('@')[0] });
        }
      });
      return results;
    };

    const saveSentToStorage = (email) => {
      const sent = JSON.parse(localStorage.getItem('sentEmails') || '[]');
      if (!sent.includes(email)) {
        sent.push(email);
        localStorage.setItem('sentEmails', JSON.stringify(sent));
      }
    };

    const getSentFromStorage = () => {
      return JSON.parse(localStorage.getItem('sentEmails') || '[]');
    };

    const renderLinks = (contacts, subject, body, filter) => {
      const container = document.getElementById('links');
      container.innerHTML = '';
      const sentEmails = getSentFromStorage();

      contacts.forEach((contact, index) => {
        const isSent = sentEmails.includes(contact.email);
        if ((filter === 'sent' && !isSent) || (filter === 'pending' && isSent)) return;

        const personalizedBody = body.replace(/\{email\}/g, contact.email).replace(/\{name\}/g, contact.name);
        const href = `mailto:${contact.email}?subject=${escapeMailContent(subject)}&body=${escapeMailContent(personalizedBody)}`;

        const link = document.createElement('a');
        link.href = href;
        link.className = 'mailto-link' + (isSent ? ' sent' : '');
        link.textContent = `${index + 1}. ‚úâÔ∏è Compose to: ${contact.name} <${contact.email}>`;

        if (!isSent) {
          link.addEventListener('click', () => {
            saveSentToStorage(contact.email);
            setTimeout(() => renderLinks(contacts, subject, body, filter), 100);
          });
        }

        container.appendChild(link);
      });
    };

    document.getElementById('generate').addEventListener('click', () => {
      const rawEmails = document.getElementById('emails').value;
      const subject = document.getElementById('subject').value;
      const body = document.getElementById('body').value;

      const contacts = extractEmails(rawEmails);

      if (contacts.length === 0) {
        document.getElementById('links').innerHTML = '<div class="warning">‚ö†Ô∏è No valid email addresses found.</div>';
        return;
      }

      renderLinks(contacts, subject, body, 'pending');
    });

    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        const filter = tab.dataset.tab;
        const rawEmails = document.getElementById('emails').value;
        const subject = document.getElementById('subject').value;
        const body = document.getElementById('body').value;
        const contacts = extractEmails(rawEmails);
        renderLinks(contacts, subject, body, filter);
      });
    });
  </script>
</body>
</html>
